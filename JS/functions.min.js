function myTimer(){var e=(new Date).getTime(),a=target_date-e;return a<10?void clearTmr():(hours=parseInt(a/36e5),a%=36e5,minutes=parseInt(a/6e4),a=parseInt(a%6e4),seconds=parseInt(a/1e3),milliseconds=parseInt(a%1e3/10),$("#auctionhoursleft").html(pad2(hours)),$("#auctionminsleft").html(pad2(minutes)),$("#auctionsecsleft").html(pad2(seconds)),void $("#auctionmillsleft").html(pad2(milliseconds)))}function stopTmr(){clearInterval(tmr)}function clearTmr(){clearInterval(tmr),$(".tmr-segment").html("00")}function pad2(e){return(e<10?"0":"")+e}function ColorLuminance(e,a){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),a=a||0;var r,t,o="#";for(t=0;t<3;t++)r=parseInt(e.substr(2*t,2),16),r=Math.round(Math.min(Math.max(0,r+r*a),255)).toString(16),o+=("00"+r).substr(r.length);return o}function randcolor(){for(var e="#"+(16777215*Math.random()<<0).toString(16);e.length<7;)e="#0"+e.substr(1);return e}function loadjs(e,a){$("#"+a).remove();var r=document.createElement("script");r.type="text/javascript",r.id=a,r.src=e,document.getElementsByTagName("head")[0].appendChild(r)}function onokmodal(){var e="";if(!(1===game.init&&$("#nPlayers").val()<2))if(1===game.init&&$("#nPlayers").val()>1){game.init++,game.nplayers=$("#nPlayers").val(),game.initmoney=$("#initial").val();for(var a=1;a<=game.nplayers;a++)e+="<table class='table' id='player"+a+"'><thead><tr><th><center><b>"+translations.players.it+": "+a+"</b></center></th></tr></thead><tbody><tr><td><div class='form-group row'><label for='Name"+a+"' class='col-sm-2 col-form-label'>"+translations.players.name+":</label><div class='col-sm-10'><input type='text' id='Name"+a+"' class='form-control input-sm' placeholder='AndRBR'></div></div><div class='form-group row'><label for='colorsel"+a+"' class='col-sm-2 col-form-label'>Color:</label><div class='col-sm-10'><input type='color' id='colorsel"+a+"' class='form-control input-sm' value='"+randcolor()+"'></div><script>game.players["+a+"] = {name: '', color: $('#colorsel"+a+"').val(), money: game['initmoney'], worth: game['initmoney'], properties: [], houses: 0};$('#colorsel"+a+"').change(function(){game.players["+a+"].color = $(this).val();});$('#Name"+a+"').change(function(){game.players["+a+"].name = $(this).val();});</script></div></td></tr><tbody></table>";$("#modaldialogbody").html(e)}else if(0===game.init)game.init++,e+="<div id='bill'><h1 id='money-indicator'></h1></div><div id='optjuego'><div id='initialdiv' class='form-group row'><label for='initial' class='col-sm-3 col-form-label'>"+translations.tags.initmoney+":</label><div class='input-group col-sm-9'><input id='initial' class='form-control input-sm' type='number' value='0'><div class='currencysymbol input-group-addon'></div></div></div><div class='form-group row'><label for='nPlayers' class='col-sm-3 col-form-label'>"+translations.tags.nplayers+":</label><div class='col-sm-9'><input id='nPlayers' type='number' class='form-control input-sm' value='0' min='0' max='9' step='1'></div></div></div><script>$('#initial').change(function() {setInitialMoney();});</script>",$("#modaldialogbody").html(e),$(document).ready(function(e){setInitialMoney()});else{game.hist=[],datafolder=$("#versionsel").val(),loadeconomicdata(datafolder),loadcardstext(datafolder),updateplayersel(),updateplayertable(),$("#histdatatable").DataTable().clear(),$("#modaldialog").modal("hide")}}function updateplayersel(){$(".playersel").html("");for(var e=0;e<=game.nplayers;e++)$(".playersel").append("<option value="+e+">"+game.players[e].name+"</option>")}function loadcardstext(e){loadjs("JS/"+e+"/cards.min.js","cardscript")}function loadcarddialogdata(e){switch(e){case"chance":$("#carddialogtitle").html(translations.tags.cards.chance);break;case"comunitychest":$("#carddialogtitle").html(translations.tags.cards.comunitychest)}$("#carddialogtxt").html(getrandcard(e))}function sellaval(){var e=$("#sellavalprop").prop("selectedIndex"),a=$("#sellavalpropto").prop("selectedIndex"),r=parseFloat($("#sellavalpropcost").html());game.players[a].properties.push(game.avalprops[e]),addmoney(a,-r),addworth(a,r),movetosold(e),appendtohistory(0,a,r,translations.histdescriptions.propsell),updateplayertable(),loadplayeropts(),$("#sellavalpropcost").html(findinprops(game.avalprops[$("#sellavalprop").val()]).price)}function getrandcard(e){var a=Math.floor(Math.random()*game.cards[e].length),r=game.cards[e][a];switch(r=r.replace(/'-goamount-'/g,game.goamount),Math.floor(2*Math.random())){case 0:a=Math.floor(Math.random()*game.avalprops.length),r=r.replace(/\'-street-\'/g,game.avalprops[a]),r=r.replace(/\'-utility-\'/g,game.propsdet.utilities.electric);break;case 1:game.soldprops.length>0?(a=Math.floor(Math.random()*game.soldprops.length),r=r.replace(/\'-street-\'/g,game.soldprops[a])):(a=Math.floor(Math.random()*game.avalprops.length),r=r.replace(/\'-street-\'/g,game.avalprops[a])),r=r.replace(/\'-utility-\'/g,game.propsdet.utilities.water)}return a=Math.floor(Math.random()*game.propsdet.railroads.names.length),r=r.replace(/\'-railroad-\'/g,game.propsdet.railroads.names[a]),r=r.replace(/\'-goamount-\'/g,game.goamount)}function loadeconomicdata(e){loadjs("JS/"+e+"/economic_data.min.js","economic_data")}function updateplayertable(){var e=$("#playerstable").DataTable();e.clear();for(var a=0;a<=game.nplayers;a++)e.row.add([game.players[a].color,game.players[a].name,game.players[a].money,game.players[a].worth]);e.draw()}function movetosold(e){game.soldprops.push(game.avalprops[e]),game.avalprops.splice(e,1),updatepropsels()}function movetoaval(e){game.avalprops.push(game.soldprops[e]),game.soldprops.splice(e,1),updatepropsels()}function updatepropsels(){$(".avalprop").html(""),$("#soldpropsel").html(""),$("#mortpropsel").html("");for(var e=0;e<game.avalprops.length;e++)$(".avalprop").append("<option value="+e+">"+game.avalprops[e]+"</option>");for(var e=0;e<game.soldprops.length;e++)$("#soldpropsel").append("<option value="+e+">"+game.soldprops[e]+"</option>");for(var e=0;e<game.mortprops.length;e++)$("#mortpropsel").append("<option value="+e+">"+game.mortprops[e]+"</option>")}function setcurrency(){$(".currencysymbol").html(currencysym)}function transfer(){var e=$("#transfromplayer").prop("selectedIndex"),a=$("#transtoplayer").prop("selectedIndex"),r=$("#transamount").val();addmoney(e,-r),addmoney(a,r),addworth(e,-r),addworth(a,r),appendtohistory(e,a,r,translations.histdescriptions.transfer),updateplayertable()}function addmoney(e,a){game.players[e].money=parseFloat(game.players[e].money)+parseFloat(a)}function addworth(e,a){game.players[e].worth=parseFloat(game.players[e].worth)+parseFloat(a)}function loadplayeropts(){var e=game.players[$("#currentplayer").prop("selectedIndex")];if($("#curplayerprops").html(""),$("#curplayermortprops").html(""),0===$("#currentplayer").prop("selectedIndex"))for(var a=0;a<game.avalprops.length;a++)$("#curplayerprops").append("<option value="+a+">"+game.avalprops[a]+"</option>");else{for(var a=0;a<e.properties.length;a++)$("#curplayerprops").append("<option value="+a+">"+e.properties[a]+"</option>");for(var a=0;a<e.properties.length;a++)for(var r=0;r<game.mortprops.length;r++)if(e.properties[a]===game.mortprops[r]){$("#curplayermortprops").append("<option value="+a+">"+e.properties[a]+"</option>");break}}showhouseandmortprices(),showselmortpayprice(),$(".playertbtn").toggleClass("disabled",0===$("#currentplayer").prop("selectedIndex"))}function showhouseandmortprices(){var e;if($("#buyhousesprice").html(""),$("#mortpropcost").html(""),e=0==$("#currentplayer").prop("selectedIndex")?game.avalprops[$("#curplayerprops").prop("selectedIndex")]:game.players[$("#currentplayer").prop("selectedIndex")].properties[$("#curplayerprops").prop("selectedIndex")],"undefined"!=typeof e){$("#mortpropcost").html(findinprops(e).mortprice);for(var a=0;a<game.propsdet.streets.length;a++)for(var r=0;r<game.propsdet.streets[a].data.length;r++)game.propsdet.streets[a].data[r].name===e&&$("#buyhousesprice").html(game.propsdet.streets[a].houseprice)}}function showselmortpayprice(){var e;if($("#mortpaycost").html(""),0==$("#currentplayer").prop("selectedIndex")?e=game.avalprops[$("#curplayerprops").prop("selectedIndex")]:$("#curplayermortprops").prop("selectedIndex")>=0&&(e=$("#curplayermortprops")[0][$("#curplayermortprops").prop("selectedIndex")].innerText),"undefined"!=typeof e){var a=parseFloat(findinprops(e).mortprice);a+=a/10,$("#mortpaycost").html(a)}}function appendtohistory(e,a,r,t){game.hist.push({from:game.players[e].name,to:game.players[a].name,amount:parseFloat(r),description:t}),$("#histdatatable").DataTable().row.add([game.hist.length,game.players[e].name,game.players[a].name,r+currencysym,t]).draw()}function setInitialMoney(){var e=$("#initial").val();$("#money-indicator").html(e+" "+currencysym)}function findinprops(e){if(game.propsdet.utilities.electric===e||game.propsdet.utilities.water===e)return game.propsdet.utilities;for(var a=0;a<game.propsdet.railroads.names.length;a++)if(game.propsdet.railroads.names[a]===e)return game.propsdet.railroads;for(var a=0;a<game.propsdet.streets.length;a++)for(var r=0;r<game.propsdet.streets[a].data.length;r++)if(game.propsdet.streets[a].data[r].name===e)return game.propsdet.streets[a].data[r]}var tmr,target_datehours,minutes,seconds,milliseconds,currencysym="",datafolder="",translations={histdescriptions:{transfer:"Transferencia",propsell:"Venta de propiedad",mortprop:"Propiedad hipotecada",mortpaid:"Hipoteca saldada",housebought:"Compra de casa/hotel",housesold:"Venta de casa/hotel",setbankrupt:"Declaración de banca rota"},Bankname:"Banco",players:{it:"Jugador",name:"Nombre"},tags:{initmoney:"Dinero Inicial",nplayers:"# Jugadores",cards:{chance:"Casualidad",comunitychest:"Arca Comunal"},railroad_single:"Ferrocarril",railroad_plural:"Ferrocarriles"},datatablelang:{sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}}},game={init:0,nplayers:0,initmoney:0,goamount:0,players:[],cards:{},taxes:{income:["10%",0],luxury:0},propsdet:{utilities:{},railroads:{},streets:[]},avalprops:[],soldprops:[],mortprops:[],hist:[]};game.players[0]={name:translations.Bankname,color:"",money:1/0,worth:1/0},$(document).ready(function(){for(var e,a="",r=datasources.length,e=1;e<5;e++)a+="<li id='rail"+e+"'></li>";for($("#railinfonames").html(a),a="",e=1;e<5;e++)a+="<li><strong>"+e+" "+(e>1?translations.tags.railroad_plural:translations.tags.railroad_single)+": </strong><span class='gamelang' id='railrent"+e+"'></span> <span class='currencysymbol gamelang'></span></li>";for($("#railinforents").html(a),e=0;e<r;e++)$("#versionsel").append("<option id='version"+e+"' value="+datasources[e].folder+"><span>"+datasources[e].folder.split("_")[0]+"</span>: "+datasources[e].version+"</option>");onokmodal(),currencysym=datasources[0].currency,setcurrency(),$("#modaldialog").modal("show"),$("#sellavalprop").change(function(){var e=game.avalprops[$("#sellavalprop").val()];$("#sellavalpropcost").html(findinprops(e).price)}),$("#navbar-newgame").click(function(){game.init=0,onokmodal()}),$("#navbar-chance").click(function(){loadcarddialogdata("chance")}),$("#navbar-comchest").click(function(){loadcarddialogdata("comunitychest")}),$("#transferbtn").click(function(){transfer()}),$("#currentplayer").change(function(){loadplayeropts()}),$("#curplayerprops").change(function(){showhouseandmortprices()}),$("#curplayermortprops").change(function(){showselmortpayprice()}),$("#mortpropbtn").click(function(){var e=$("#curplayerprops").prop("selectedIndex");if(e>=0){var a=$("#currentplayer").prop("selectedIndex"),r=0,t=parseFloat($("#mortpropcost").html());addmoney(a,-t),addworth(a,-t),game.mortprops.push(game.players[a].properties[e]),updatepropsels(),loadplayeropts(),appendtohistory(a,r,t,translations.histdescriptions.mortprop),updateplayertable()}}),$("#buyhousebtn").click(function(){var e=$("#currentplayer").prop("selectedIndex");if(""!==$("#buyhousesprice").html()&&e>0){var a=0,r=parseFloat($("#buyhousesprice").html());addmoney(e,-r),game.players[e].houses++,appendtohistory(e,a,r,translations.histdescriptions.housebought),updateplayertable()}}),$("#sellhousebtn").click(function(){var e=$("#currentplayer").prop("selectedIndex");if(""!==$("#buyhousesprice").html()&&e>0){var a=0,r=parseFloat($("#buyhousesprice").html());addmoney(e,r),game.players[e].houses--,appendtohistory(e,a,r,translations.histdescriptions.housesold),updateplayertable()}}),$("#sellpropbtn").click(function(){var e=$("#currentplayer").prop("selectedIndex"),a=$("#sellplayertoplayer").prop("selectedIndex"),r=$("#curplayerprops").prop("selectedIndex"),t=parseFloat($("#sellpropprice").val()),o=parseFloat(findinprops($("#curplayerprops")[0][r].innerText).price);addmoney(e,t),addworth(e,t-o),0===a?game.avalprops.push(game.players[e].properties[r]):(addmoney(a,-t),addworth(a,o-t),game.players[a].properties.push(game.players[e].properties[r])),game.players[e].properties.splice(r,1),updatepropsels(),loadplayeropts(),appendtohistory(e,a,t,translations.histdescriptions.propsell),updateplayertable()}),$("#paymortbtn").click(function(){var e=$("#curplayermortprops").prop("selectedIndex");if(e>=0){var a=$("#currentplayer").prop("selectedIndex"),r=0,t=parseFloat($("#mortpaycost").html());addmoney(a,-t),addworth(a,-t);for(var o=0;o<game.mortprops.length;o++)game.mortprops[o]===$("#curplayermortprops")[0][e].innerText&&game.mortprops.splice(o,1);updatepropsels(),loadplayeropts(),appendtohistory(a,r,t,translations.histdescriptions.mortpaid),updateplayertable()}}),$("#bankruptbtn").click(function(){var e=$("#currentplayer").prop("selectedIndex");0!=e&&($.each(game.players[e].properties,function(e,a){$.each(game.soldprops,function(e,r){r===a&&(game.avalprops[game.avalprops.length]=a,game.soldprops.splice(e,1))})}),appendtohistory(e,e,NaN,histdescriptions.setbankrupt),game.players.splice(e,1),game.nplayers--,updateplayersel(),updatepropsels(),loadplayeropts(),updateplayertable())}),$(".btn").mouseup(function(){$(this).blur()}),$("#newgame-ok-btn").click(function(){onokmodal()}),$("#versionsel").change(function(){currencysym=datasources[$("#versionsel").prop("selectedIndex")].currency,setcurrency()}),$("#starttmr-btn").click(function(){target_date=new Date(Date.now()+10*parseInt($("#tmr-mills").val())+1e3*parseInt($("#tmr-secs").val())+6e4*parseInt($("#tmr-mins").val())+36e5*parseInt($("#tmr-hours").val())).getTime(),tmr=setInterval(function(){myTimer()},10)}),$("#stoptmr-btn").click(function(){stopTmr()}),$("#resettmr-btn").click(function(){clearTmr()}),$("#transgoamount").click(function(){$("#transamount").val(game.goamount),$("#transfromplayer").val("0")}),$("#luxurytaxbtn").click(function(){$("#transamount").val(game.taxes.luxury),$("#transtoplayer").val("0")}),$("#incometaxbtn").click(function(){$("#transamount").val(game.taxes.income[1]),$("#transtoplayer").val("0")}),$(".DataTable").DataTable({language:translations.datatablelang,scrollY:300,scrollX:!0,scrollCollapse:!0,columnDefs:[{targets:0,createdCell:function(e,a,r,t,o){7===a.length&&/#[0-9|a-f]{6}/i.test(a)&&($(e).css("background-color",a),$(e).html(""))}},{targets:[2,3],createdCell:function(e,a,r,t,o){a<0&&$(e).css("color","#ff0000")}}]})});